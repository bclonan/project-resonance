<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Snapshot Analyzer</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <style>
    .box { background:#f8f9fa; padding:1rem; border-radius:6px; margin-top:1rem; }
    .row { margin-top:0.5rem; }
    code { background:#eef; padding:0 4px; border-radius:3px; }
    .muted { color:#7f8c8d; }
  </style>
</head>
<body>
  <div class="container">
    <div class="demo-container">
      <div class="demo-header">
        <div>
          <h2>Snapshot Analyzer (Verifiable)</h2>
          <p>Download a verifiable ZIP of the last N seconds from the live market feed and compare compression offline (gzip, zstd) vs PhiComp.</p>
        </div>
        <a href="/" class="back-link">← Back to Demos</a>
      </div>

      <div class="box">
        <div class="row">
          <label for="duration">Duration (seconds):</label>
          <input id="duration" type="number" value="10" min="3" max="120" />
          <button id="btnZip" class="button">Download ZIP snapshot</button>
          <span id="out" class="muted"></span>
        </div>
        <div class="row muted">
          This ZIP contains <code>raw.ndjson</code>, <code>phicomp.bin</code>, <code>gzip.bin</code>, and <code>stats.json</code>.
          Use <code>python tools/compare_snapshot_zstd.py &lt;zip&gt;</code> to compare sizes (zstandard optional).
        </div>
      </div>

      <div class="box">
        <h3>Offline verify (PowerShell)</h3>
        <pre><code>python tools/compare_snapshot_zstd.py path/to/market_snapshot_10s.zip</code></pre>
        <p class="muted">If <code>zstandard</code> isn’t installed, the script still runs (skips zstd line).</p>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('btnZip').addEventListener('click', async () => {
      const d = Math.max(3, Math.min(120, parseInt(document.getElementById('duration').value || '10', 10)));
      const res = await fetch(`/api/market_snapshot?duration_s=${d}`);
      if (!res.ok) { document.getElementById('out').textContent = 'Snapshot failed'; return; }
      const blob = await res.blob();
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `market_snapshot_${d}s.zip`;
      a.click();
      document.getElementById('out').textContent = `Saved market_snapshot_${d}s.zip`;
    });
  </script>
</body>
</html>

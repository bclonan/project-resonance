<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo 1: Load Balancer Visualizer</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <div class="demo-container">
            <div class="demo-header">
    <div>
        <h2>Live Load Balancer Visualizer</h2>
        <p>
            We compare two ways of spreading incoming requests across many servers:
            <strong>Traditional Round‑Robin</strong> (take turns) vs <strong>PhiBalancer</strong> (uses math to avoid hidden patterns).
            In plain terms: fewer traffic jams and smoother performance during rush hour.
        </p>
        <p style="font-size:0.95rem;color:#7f8c8d;">
            Everyday impact: faster page loads, fewer "try again" errors during ticket drops or sales, and more stable video/live streams.
            In tech terms: less contention and better cache locality via quasi‑uniform hashing.
        </p>
    </div>
    <nav>
        <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/research">Research</a>
        <a href="/architecture">Architecture</a>
    </nav>
</div>

            <h3>Traditional (Round-Robin)</h3>
            <div class="balancer-grid" id="traditional-grid"></div>

            <h3>Project Resonance (PhiBalancer)</h3>
            <div class="balancer-grid" id="resonance-grid"></div>
            <p style="margin-top:1rem;font-size:0.95rem;color:#7f8c8d;">
                Verify it yourself: watch how the green cluster lights up more evenly over time than the traditional one—this means more consistent latency.
            </p>
            <div class="try-box" style="margin-top:1rem;background:#f8f9fa;padding:1rem;border-radius:6px;">
                <strong>Try it yourself:</strong>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap;margin-top:0.5rem;">
                    <button id="btnCheckTrad" class="button">Measure fairness (Traditional)</button>
                    <button id="btnCheckPhi" class="button" style="background:#9b59b6;">Measure fairness (PhiBalancer)</button>
                    <span id="fairnessOut" style="align-self:center;color:#7f8c8d;"></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const traditionalGrid = document.getElementById('traditional-grid');
        const resonanceGrid = document.getElementById('resonance-grid');
        const numServers = 100;

        // Create server elements
        for (let i = 0; i < numServers; i++) {
            const server1 = document.createElement('div');
            server1.className = 'server';
            server1.id = `trad-server-${i}`;
            traditionalGrid.appendChild(server1);

            const server2 = document.createElement('div');
            server2.className = 'server';
            server2.id = `res-server-${i}`;
            resonanceGrid.appendChild(server2);
        }

        // Simulate requests
        setInterval(async () => {
            const requestId = Math.floor(Math.random() * 1e9);

            // Traditional
            const tradResponse = await fetch(`/api/balance?method=traditional&request_id=${requestId}`);
            const tradData = await tradResponse.json();
            highlightServer('trad', tradData.server_index);

            // Resonance
            const resResponse = await fetch(`/api/balance?method=resonance&request_id=${requestId}`);
            const resData = await resResponse.json();
            highlightServer('res', resData.server_index);

        }, 10); // 100 requests per second

        function highlightServer(prefix, index) {
            const server = document.getElementById(`${prefix}-server-${index}`);
            if (server) {
                server.classList.add('active');
                setTimeout(() => server.classList.remove('active'), 200);
            }
        }

        // Fairness checks
        async function check(method){
            const res = await fetch(`/api/balance_stats?method=${method}&n=10000&seed=42`);
            const data = await res.json();
            document.getElementById('fairnessOut').textContent = `${method}: spread=${data.spread} stddev=${data.stddev.toFixed(2)}`;
        }
        document.getElementById('btnCheckTrad').addEventListener('click', () => check('traditional'));
        document.getElementById('btnCheckPhi').addEventListener('click', () => check('resonance'));
    </script>
</body>
</html>